## Как реализовать `std::thread`, используя сисколлы?

Для реализации `std::thread` потребуется использовать сискол `clone`

```shell
  man 2 clone
```

## Как пользоваться сисколлом `clone` и какие у него есть параметры?

```c++
int clone(int (*fn)(void *_Nullable), void *stack, int flags,
         void *_Nullable arg, ...  /* pid_t *_Nullable parent_tid,
                                      void *_Nullable tls,
                                      pid_t *_Nullable child_tid */ );
```

* `int (*fn)(void *_Nullable)` - функция, которую выполнит потомок
* `stack` - указатель на начало стека потомка
* `flags` - флаги разделения ресурсов
  * `CLONE_VM` — общее адресное пространство.
  - `CLONE_FS` — общая информация о файловой системе.
  - `CLONE_FILES` — общие файловые дескрипторы.
  - `CLONE_SIGHAND` — общие обработчики сигналов.
  - `CLONE_THREAD` — поток в той же группе потоков.
  * Есть и другие

## Что из себя представляют треды с точки зрения ОС?

В Linux потоки реализованы как легковесные процессы (Lightweight Processes, LWP), которые используют `clone()` с флагами, указывающими на общие ресурсы.

Важно — потоки разделяют одно и то же адресное пространство (maps один и тот же), также у них одинаковые Signal Handler'ы.

## Что такое тред-группа?

Тред-группа — это набор потоков (тредов), которые разделяют один и тот же Thread Group ID (`TGID`), 
то есть принадлежат одному процессу с точки зрения операционной системы.

## Что такое `tid`, `tgid`, как их узнать, в чем разница с `pid`?

* `pid` - Process ID (в документации)
* `tid` - Thread ID (реальный ID потока)
* `tgid` - Thread Group ID (ID группы потоков)	

```text
=== Главный поток ===
getpid()  = 12345 ← Это TGID всей группы потоков
gettid()  = 12345 ← Это TID главного потока  
getppid() = 500   ← Это PID bash/shell, который запустил программу

Создаю 3 дочерних потока...

=== Дочерний поток 1 ===
Что возвращает getpid()  = 12345 (TGID)        ← ТАКОЕ ЖЕ как у главного!
Что возвращает gettid()  = 12346 (мой TID)     ← ДРУГОЕ! Уникальный!
Что возвращает getppid() = 500 (PID родительского ПРОЦЕССА) ← ТАКОЕ ЖЕ!

=== Дочерний поток 2 ===
Что возвращает getpid()  = 12345 (TGID)        ← ТАКОЕ ЖЕ!
Что возвращает gettid()  = 12347 (мой TID)     ← ДРУГОЕ!
Что возвращает getppid() = 500 (PID родительского ПРОЦЕССА) ← ТАКОЕ ЖЕ!

=== Дочерний поток 3 ===
Что возвращает getpid()  = 12345 (TGID)        ← ТАКОЕ ЖЕ!
Что возвращает gettid()  = 12348 (мой TID)     ← ДРУГОЕ!
Что возвращает getppid() = 500 (PID родительского ПРОЦЕССА) ← ТАКОЕ ЖЕ!
```

Узнать можно через `htop`

## Как послать сигнал отдельному треду?

```shell
  man 2 tgkill
```
